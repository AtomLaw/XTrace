The following code is adapted from Tiark Rompf's work using delimited
continuations for handling HTTP streams.