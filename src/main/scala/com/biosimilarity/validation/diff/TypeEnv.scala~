// -*- mode: Scala;-*- 
// Filename:    TypeEnv.scala 
// Authors:     lgm                                                    
// Creation:    Fri Jan 22 10:19:59 2010 
// Copyright:   Not supplied 
// Description: 
// ------------------------------------------------------------------------

package com.biosimilarity.differential

trait TypeEnvironment[Name, NSeq <: NmSeq[Name]]
      extends Seq[(Name,RegularType[Name,NSeq])]
      with NmSeqOps[Name,NSeq]
      with MapProxy[Name,RegularType[Name,NSeq]] {
	val emptiness = new HashMap[Name,RegularType[Name,NSeq]]()
	def types : Seq[RegularType[Name,NSeq]]	
	override def self = {
	  emptiness
	}
      }

case class TypeAssignment[Name, NSeq <: NmSeq[Name]](
  map : HashMap[Name,RegularType[Name,NSeq]]
) extends TypeEnvironment[Name,NSeq] {
  override def self = map
}

case class TypeEnvRestriction[Name, NSeq <: NmSeq[Name]](
  x : Name
  env : TypeAssignment[Name, NSeq <: NmSeq[Name]]
) extends TypeEnvironment[Name,NSeq] {
  var _memo = Option[HashMap[Name,RegularType[Name,NSeq]]] = None
  override def self = {
    _memo match {
      case None => {
	val map = new HashMap[Name,RegularType[Name,NSeq]]()
	env.get( x ) match {
	  case Some( t ) => map.add( x, t )
	  case None => {
	  }
	}
	_memo = Some( map )
	map
      }      
      case Some( map ) => map
    }
  }
}
